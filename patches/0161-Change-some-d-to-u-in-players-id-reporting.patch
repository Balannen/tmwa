From 91de9f0bdd9c4ace49e7950a328171fdd4267fa3 Mon Sep 17 00:00:00 2001
From: Andrei Karas <akaras@inbox.ru>
Date: Sat, 1 Jan 2011 17:23:50 +0200
Subject: [PATCH 161/226] Change some %d to %u in players id reporting.

Also add fixes for new slots implimentation.
---
 src/char/char.c |  2 +-
 src/map/clif.c  | 14 ++++++++------
 src/map/map.h   |  6 ++++--
 3 files changed, 13 insertions(+), 9 deletions(-)

diff --git a/src/char/char.c b/src/char/char.c
index 7673f26..f9c0c1b 100644
--- a/src/char/char.c
+++ b/src/char/char.c
@@ -2647,7 +2647,7 @@ int parse_frommap (int fd)
                     WFIFOL (fd, 2) = RFIFOL (fd, 2);
                     WFIFOSET (fd, 6);
                     printf
-                        ("auth_fifo search error! account %d not authentified.\n",
+                        ("auth_fifo search error! account %u not authentified.\n",
                          RFIFOL (fd, 2));
                 }
                 RFIFOSKIP (fd, 22);
diff --git a/src/map/clif.c b/src/map/clif.c
index 20c0691..4f5a795 100644
--- a/src/map/clif.c
+++ b/src/map/clif.c
@@ -1288,6 +1288,8 @@ static int equip_points[LOOK_LAST + 1] = {
     1,                          /* cape */
     7,                          /* misc1 */
     0,                          /* misc2 */
+    0,                          /* evol ring 1? */
+    0,                          /* evol ring 2? */
 };
 
 /*==========================================
@@ -2694,7 +2696,7 @@ int clif_changelook_towards (struct block_list *bl, int type, int val,
             int  equip_point = equip_points[type];
 
             WBUFB (buf, 6) = type;
-            if (sd->equip_index[equip_point] >= 0)
+            if (equip_point >= 0 && sd->equip_index[equip_point] >= 0)
             {
                 if (sd->
                     inventory_data[sd->equip_index[equip_point]]->view_id > 0)
@@ -10398,11 +10400,11 @@ static int clif_parse (int fd)
             if (sd->status.name != NULL)
                 printf ("Player [%s] has logged off your server.\n", sd->status.name);  // Player logout display [Valaris]
             else
-                printf ("Player with account [%d] has logged off your server.\n", sd->bl.id);   // Player logout display [Yor]
+                printf ("Player with account [%u] has logged off your server.\n", sd->bl.id);   // Player logout display [Yor]
         }
         else if (sd)
         {                       // not authentified! (refused by char-server or disconnect before to be authentified)
-            printf ("Player with account [%d] has logged off your server (not auth account).\n", sd->bl.id);    // Player logout display [Yor]
+            printf ("Player with account [%u] has logged off your server (not auth account).\n", sd->bl.id);    // Player logout display [Yor]
             map_deliddb (&sd->bl);  // account_id has been included in the DB before auth answer
         }
         if (fd)
@@ -10527,18 +10529,18 @@ static int clif_parse (int fd)
                     {
                         if (sd->status.name != NULL)
                             fprintf (fp,
-                                     "%sPlayer with account ID %d (character ID %d, player name %s) sent wrong packet:\n",
+                                     "%sPlayer with account ID %u (character ID %u, player name %s) sent wrong packet:\n",
                                      asctime (gmtime (&now)),
                                      sd->status.account_id,
                                      sd->status.char_id, sd->status.name);
                         else
                             fprintf (fp,
-                                     "%sPlayer with account ID %d sent wrong packet:\n",
+                                     "%sPlayer with account ID %u sent wrong packet:\n",
                                      asctime (gmtime (&now)), sd->bl.id);
                     }
                     else if (sd)    // not authentified! (refused by char-server or disconnect before to be authentified)
                         fprintf (fp,
-                                 "%sPlayer with account ID %d sent wrong packet:\n",
+                                 "%sPlayer with account ID %u sent wrong packet:\n",
                                  asctime (gmtime (&now)), sd->bl.id);
 
                     fprintf (fp,
diff --git a/src/map/map.h b/src/map/map.h
index 7814a12..e756014 100644
--- a/src/map/map.h
+++ b/src/map/map.h
@@ -699,7 +699,9 @@ enum
     LOOK_GLOVES,
     LOOK_CAPE,
     LOOK_MISC1,
-    LOOK_MISC2
+    LOOK_MISC2,
+    LOOK_EVOL_RING1,
+    LOOK_EVOL_RING2
 };
 
 enum
@@ -708,7 +710,7 @@ enum
     EQUIP_WEAPON = 9
 };
 
-#define LOOK_LAST LOOK_MISC2
+#define LOOK_LAST LOOK_EVOL_RING2
 
 struct chat_data
 {
-- 
2.1.0

