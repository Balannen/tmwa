From e6422b8a5fcf7c91a88f17cf75fa10634db29f7c Mon Sep 17 00:00:00 2001
From: Andrei Karas <akaras@inbox.ru>
Date: Thu, 23 Dec 2010 04:08:07 +0200
Subject: [PATCH 136/226] Port from eathena script command compare.

---
 src/map/script.c | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/src/map/script.c b/src/map/script.c
index 287f0c7..0c2eefb 100644
--- a/src/map/script.c
+++ b/src/map/script.c
@@ -430,6 +430,7 @@ int  buildin_recovery (struct script_state *st); // [4144]
 int  buildin_getmapmobs (struct script_state *st); //end jA addition
 int  buildin_getstrlen (struct script_state *st); //strlen [Valaris]
 int  buildin_charisalpha (struct script_state *st); //isalpha [Valaris]
+int  buildin_compare (struct script_state *st); // Lordalfa - To bring strstr to scripting Engine.
 
 void push_val (struct script_stack *stack, int type, int val);
 int  run_func (struct script_state *st);
@@ -887,6 +888,8 @@ struct
     buildin_getstrlen, "getstrlen", "s"}, //strlen [Valaris]
     {
     buildin_charisalpha, "charisalpha", "si"}, //isalpha [Valaris]
+    {
+    buildin_compare, "compare", "ss"}, // Lordalfa - To bring strstr to scripting Engine.
         // End Additions
     {
 NULL, NULL, NULL},};
@@ -8260,6 +8263,22 @@ BUILDIN_FUNC(charisalpha)
     return 0;
 }
 
+// case-insensitive substring search [lordalfa]
+BUILDIN_FUNC(compare)
+{
+    const char *message;
+    const char *cmpstring;
+    message = script_getstr(st, 2);
+    cmpstring = script_getstr(st, 3);
+    if (!message || !cmpstring)
+    {
+        script_pushint(st, 0);
+        return 0;
+    }
+    script_pushint(st, (stristr(message, cmpstring) != NULL));
+    return 0;
+}
+
 //
 // ��s��main
 //
-- 
2.1.0

