From 480256585279475a57c136565d12e2da3301afe0 Mon Sep 17 00:00:00 2001
From: Andrei Karas <akaras@inbox.ru>
Date: Sat, 15 Jan 2011 23:01:10 +0200
Subject: [PATCH 193/226] Port from eathena script command rid2name.

---
 src/map/script.c | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)

diff --git a/src/map/script.c b/src/map/script.c
index 21bfd39..dbc7450 100644
--- a/src/map/script.c
+++ b/src/map/script.c
@@ -454,6 +454,7 @@ int  buildin_setitemscript (struct script_state *st); //Set NEW item bonus scrip
 int  buildin_getmonsterinfo (struct script_state *st);// Lupus
 int  buildin_axtoi (struct script_state *st);
 int  buildin_atoi (struct script_state *st);
+int  buildin_rid2name (struct script_state *st);
 int  buildin_setnpcclass (struct script_state *st); // [4144]
 int  buildin_getnpcclass (struct script_state *st); // [4144]
 int  buildin_l (struct script_state *st); // [4144]
@@ -959,6 +960,8 @@ struct
     {
     buildin_axtoi, "atoi", "s"},
     {
+    buildin_rid2name, "rid2name", "i"},
+    {
     buildin_setnpcclass, "setnpcclass", "*"}, // [4144]
     {
     buildin_getnpcclass, "getnpcclass", "*"}, // [4144]
@@ -8916,6 +8919,31 @@ BUILDIN_FUNC(atoi)
     return 0;
 }
 
+BUILDIN_FUNC(rid2name)
+{
+    struct block_list *bl = NULL;
+    int rid = script_getnum(st, 2);
+    if ((bl = map_id2bl(rid)))
+    {
+        switch(bl->type)
+        {
+            case BL_MOB: script_pushstrcopy(st, ((TBL_MOB*)bl)->name); break;
+            case BL_PC:  script_pushstrcopy(st, ((TBL_PC*)bl)->status.name); break;
+            case BL_NPC: script_pushstrcopy(st, ((TBL_NPC*)bl)->exname); break;
+            default:
+                ShowError("buildin_rid2name: BL type unknown.\n");
+                script_pushconststr(st, "");
+                break;
+        }
+    }
+    else
+    {
+        ShowError("buildin_rid2name: invalid RID\n");
+        script_pushconststr(st, "(null)");
+    }
+    return 0;
+}
+
 BUILDIN_FUNC(setnpcclass)
 {
     int  newsprite;
-- 
2.1.0

